name: Natural Daily Contributions

on:
  schedule:
    - cron: "0 5 * * *"  # 1 PM PH Time
  workflow_dispatch:

jobs:
  contribute:
    runs-on: ubuntu-latest
    permissions:
      contents: write

    env:
      TZ: "Asia/Manila"
      GIT_AUTHOR_NAME: "JoeyCollado"
      GIT_COMMITTER_NAME: "JoeyCollado"
      GIT_AUTHOR_EMAIL: "144526580+JoeyCollado@users.noreply.github.com"
      GIT_COMMITTER_EMAIL: "144526580+JoeyCollado@users.noreply.github.com"

    steps:
      - uses: actions/checkout@v4

      - name: Contribution Engine
        env:
          TOKEN: ${{ secrets.GH_PAT }}
        run: |
          set -e

          # -----------------------------------------
          # CONFIG
          # -----------------------------------------
          TOTAL=$((RANDOM % 6 + 10)) # 10â€“15 commits
          MIN_DELAY=20
          MAX_DELAY=60

          repos=(
            "JoeyCollado/Java-oop"
            "JoeyCollado/ExpressJsCourse"
            "JoeyCollado/absolute-movie"
            "JoeyCollado/portfolio2"
            "JoeyCollado/prisma-mongodb"
            "JoeyCollado/crud-project"
          )

          # AI-style commit message generator
          ai_msgs=(
            "refactor: improve code readability in module"
            "chore: adjust helper logic for smoother execution"
            "style: normalize formatting and spacing"
            "feat: enhance internal utility functions"
            "improvement: fine-tune module behaviors"
            "update: small internal logic refresh"
            "cleanup: remove stray redundant operations"
            "refactor: streamline code sections for clarity"
            "enhancement: tighten minor logic flow"
            "internal: adjust code paths for maintainability"
          )

          # files eligible for "real dev" modifications
          code_targets=("*.js" "*.ts" "*.jsx" "*.tsx" "*.py")

          echo "Commits today: $TOTAL"

          # -----------------------------------------
          # LOOP
          # -----------------------------------------
          for n in $(seq 1 $TOTAL); do
            repo=${repos[$RANDOM % ${#repos[@]}]}

            echo "--- Working on $repo ---"

            git clone "https://x-access-token:${TOKEN}@github.com/$repo.git" repo --quiet || {
              echo "Clone failed, skipping..."
              continue
            }

            cd repo

            # Author identity
            git config user.name "$GIT_AUTHOR_NAME"
            git config user.email "$GIT_AUTHOR_EMAIL"

            # Pick a random file type
            pattern=${code_targets[$RANDOM % ${#code_targets[@]}]}
            target=$(find . -type f -name "$pattern" | shuf -n 1 || true)

            # If none found, create a .keepalive file
            if [ -z "$target" ]; then
              target=".keepalive"
              echo "" >> "$target"
            fi

            # -----------------------------------------
            # RANDOM CODE CHANGE SIMULATION
            # -----------------------------------------
            ts=$(date '+%H:%M:%S')

            echo "// auto-update $ts" >> "$target"

            # AI-style commit message
            msg=${ai_msgs[$RANDOM % ${#ai_msgs[@]}]}

            git add "$target"
            if git commit -m "$msg" --quiet; then
              git push --quiet || echo "Push failed"
              echo "[OK] Commit pushed: $msg"
            else
              echo "[SKIP] Nothing changed"
            fi

            cd ..
            rm -rf repo

            # -----------------------------------------
            # REALISTIC HUMAN DELAY
            # -----------------------------------------
            wait=$((RANDOM % (MAX_DELAY - MIN_DELAY) + MIN_DELAY))
            echo "Sleeping $wait seconds..."
            sleep $wait
          done
