name: Natural Daily Contributions

on:
  schedule:
    - cron: "0 1 * * *" # runs once daily at 9:00 AM PH time (UTC+8)
  workflow_dispatch:

jobs:
  contribute:
    runs-on: ubuntu-latest
    permissions:
      contents: write

    env:
      GIT_AUTHOR_EMAIL: "144526580+JoeyCollado@users.noreply.github.com"
      GIT_COMMITTER_EMAIL: "144526580+JoeyCollado@users.noreply.github.com"
      GIT_AUTHOR_NAME: "JoeyCollado"
      GIT_COMMITTER_NAME: "JoeyCollado"
      TZ: "Asia/Manila"

    steps:
      - name: Clone and commit to multiple repositories with random schedule
        env:
          TOKEN: ${{ secrets.PERSONAL_ACCESS_TOKEN }}
        run: |
          repos=(
            "JoeyCollado/Java-oop"
            "JoeyCollado/ExpressJsCourse"
            "JoeyCollado/absolute-movie"
            "JoeyCollado/portfolio2"
            "JoeyCollado/prisma-mongodb"
            "JoeyCollado/crud-project"
          )

          msgs=(
            "minor cleanup"
            "small tweak"
            "adjusted some formatting"
            "slight refactor"
            "updated minor metadata"
            "maintenance pass"
            "tiny improvements"
            "code polish"
            "dependency check"
            "minor optimization"
          )

          files=(
            "README.md"
            ".keepalive"
            ".github/meta.log"
            "system.config"
            "env.example"
            "data.json"
          )

          for repo in "${repos[@]}"; do
            echo "Processing $repo ..."
            git clone "https://x-access-token:${TOKEN}@github.com/$repo.git"
            cd "$(basename "$repo")"
            git config user.name "$GIT_AUTHOR_NAME"
            git config user.email "$GIT_AUTHOR_EMAIL"

            count=$((RANDOM % 11 + 10))  # 10â€“20 commits
            echo "Generating $count commits for $repo..."

            for i in $(seq 1 $count); do
              target=${files[$RANDOM % ${#files[@]}]}
              touch "$target"
              echo "update $(date +%s)" >> "$target"
              git add "$target"
              msg=${msgs[$RANDOM % ${#msgs[@]}]}
              git commit -m "$msg" || true
              git push origin main || git push origin master || true

              # random sleep between 15 minutes to 1 hour 30 minutes
              delay=$(( (RANDOM % 4500) + 900 ))
              echo "Sleeping for $delay seconds (~$((delay/60)) min)..."
              sleep $delay
            done

            cd ..
            rm -rf "$(basename "$repo")"
          done
