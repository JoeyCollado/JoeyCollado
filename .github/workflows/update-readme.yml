on:
  schedule:
    - cron: "0 5 * * *"
  workflow_dispatch:

jobs:
  contribute:
    runs-on: ubuntu-latest

    permissions:
      contents: write

    steps:
      - name: Checkout main repository
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.PAT }}

      - name: Configure git
        run: |
          git config user.name "JoeyCollado"
          git config user.email "akosijoeyaibertcollado@gmail.com"

      - name: Setup environment
        run: mkdir -p activity

      - name: Make 10â€“15 dynamic commits
        run: |
          VERBS=("Fix" "Update" "Refactor" "Add" "Improve" "Adjust" "Polish" "Sync" "Enhance")
          ADJECTIVES=("quickly" "minor" "tiny" "small" "light" "temporary" "experimental")
          TYPO_CHANCE=20
          FILES=("activity/log.txt" "activity/notes.txt" "activity/history.md" "activity/dev-diary.txt" "*.js" "*.ts" "*.py")

          COMMITS=$((10 + RANDOM % 6))
          echo "Planning $COMMITS commits..."

          for ((i=1; i<=$COMMITS; i++)); do
            FILE="${FILES[$RANDOM % ${#FILES[@]}]}"

            if [[ "$FILE" == *.js || "$FILE" == *.ts || "$FILE" == *.py ]]; then
              echo "// temp edit $(date +"%T")" >> "$FILE"
              SNIPPET=$(tail -n 1 "$FILE")
              DESC="code change: ${SNIPPET:0:30}"
            else
              echo "Random update @ $(date +"%T")" >> "$FILE"
              DESC="update in $FILE"
            fi

            VERB="${VERBS[$RANDOM % ${#VERBS[@]}]}"
            ADJ="${ADJECTIVES[$RANDOM % ${#ADJECTIVES[@]}]}"
            MSG="$VERB $DESC $ADJ"

            if (( RANDOM % 100 < TYPO_CHANCE )); then
              LEN=${#MSG}
              POS=$((RANDOM % LEN))
              MSG="${MSG:0:$POS}${MSG:$((POS+1))}"
            fi

            if (( RANDOM % 2 == 0 )); then
              MSG=$(echo "$MSG" | awk '{print toupper(substr($0,1,1)) substr($0,2)}')
            fi

            PUNCTUATION=("." "!" "" "...")
            MSG="$MSG${PUNCTUATION[$RANDOM % ${#PUNCTUATION[@]}]}"

            git add "$FILE"
            git commit -m "$MSG"

            sleep $((5 + RANDOM % 20))
          done

      - name: Add additional repository remotes
        run: |
          git remote add gemini-cli https://x-access-token:${{ secrets.PAT }}@github.com/JoeyCollado/gemini-cli.git
          git remote add joeycollado https://x-access-token:${{ secrets.PAT }}@github.com/JoeyCollado/JoeyCollado.git
          git remote add prisma-course https://x-access-token:${{ secrets.PAT }}@github.com/JoeyCollado/Prisma-Course.git
          git remote add nextjscourse2 https://x-access-token:${{ secrets.PAT }}@github.com/JoeyCollado/nextJsCourse2.git
          git remote add java-oop https://x-access-token:${{ secrets.PAT }}@github.com/JoeyCollado/Java-oop.git

      - name: Push changes to all repositories (with retries)
        run: |
          repos=("origin" "gemini-cli" "joeycollado" "prisma-course" "nextjscourse2" "java-oop")

          for repo in "${repos[@]}"; do
            echo "---- Pushing to $repo ----"
            success=false

            for attempt in {1..3}; do
              git push "$repo" HEAD && { success=true; break; }
              echo "Push to $repo failed (attempt $attempt), retrying..."
              sleep $((5 + RANDOM % 10))
            done

            if [ "$success" = false ]; then
              echo "Skipping $repo after 3 failed attempts"
            else
              echo "Successfully pushed to $repo"
            fi

            sleep $((3 + RANDOM % 7))
          done
