name: Daily Activity Bot

on:
  schedule:
    # Runs daily at 12:00 AM Philippines time (UTC+8)
    - cron: "0 16 * * *"
  workflow_dispatch:

jobs:
  commit:
    runs-on: ubuntu-latest
    permissions:
      contents: write

    strategy:
      fail-fast: false
      matrix:
        repo:
          - ExpressJsCourse
          - Prisma-Course
          - nextJsCourse2
          - Java-oop

    steps:
      - name: Random delay (0â€“8 hours)
        run: |
          sleep $((RANDOM % 18000))

      - name: Checkout repo
        uses: actions/checkout@v4
        with:
          repository: JoeyCollado/${{ matrix.repo }}
          token: ${{ secrets.GITHUB_PAT }}
          fetch-depth: 1

      - name: Configure git
        run: |
          git config --global user.name "JoeyCollado"
          git config --global user.email "akosijoeyaibertcollado@gmail.com"

      - name: Make small change
        run: |
          CANDIDATES=()

          [ -f README.md ] && CANDIDATES+=("README.md")
          [ -f docs/notes.md ] && CANDIDATES+=("docs/notes.md")
          [ -f src/index.ts ] && CANDIDATES+=("src/index.ts")
          [ -f app/page.tsx ] && CANDIDATES+=("app/page.tsx")

          if [ ${#CANDIDATES[@]} -eq 0 ]; then
            echo "No editable files found, skipping."
            exit 0
          fi

          FILE="${CANDIDATES[$RANDOM % ${#CANDIDATES[@]}]}"

          echo "" >> "$FILE"
          echo "<!-- update $(date -u) -->" >> "$FILE"

          git add "$FILE"
          git diff --cached --quiet && exit 0

          git commit -m "chore: minor update"
          git push
