name: Workflow

on:
  schedule:
    - cron: "0 0 * * *"   # baseline only
  workflow_dispatch:

jobs:
  contribute:
    runs-on: ubuntu-latest
    permissions:
      contents: write

    strategy:
      matrix:
        repo:
          - gemini-cli
          - Prisma-Course
          - nextJsCourse2
          - Java-oop

    steps:
      - name: Random delay (0â€“8 hours)
        run: |
          sleep $((RANDOM % 28800))

      - name: Checkout target repo
        uses: actions/checkout@v4
        with:
          repository: JoeyCollado/${{ matrix.repo }}
          token: ${{ secrets.PAT }}
          path: repo

      - name: Configure git
        run: |
          git config --global user.name "JoeyCollado"
          git config --global user.email "akosijoeyaibertcollado@gmail.com"

      - name: Select realistic file
        run: |
          cd repo

          CANDIDATES=()

          [ -f README.md ] && CANDIDATES+=("README.md")
          [ -d docs ] && CANDIDATES+=("docs/notes.md")
          [ -d src ] && CANDIDATES+=("src/index.ts")
          [ -d app ] && CANDIDATES+=("app/page.tsx")

          if [ ${#CANDIDATES[@]} -eq 0 ]; then
            echo "No safe files found, skipping"
            exit 0
          fi

          FILE="${CANDIDATES[$RANDOM % ${#CANDIDATES[@]}]}"
          mkdir -p "$(dirname "$FILE")"

          echo "" >> "$FILE"

          git add "$FILE"
          git diff --cached --quiet && exit 0

      - name: Commit & push
        run: |
          cd repo

          MSGS=(
            "Improve documentation clarity"
            "Minor wording cleanup"
            "Clarify example usage"
            "Small readability improvement"
            "Tweak comments for clarity"
          )

          git commit -m "${MSGS[$RANDOM % ${#MSGS[@]}]}"
          git push
