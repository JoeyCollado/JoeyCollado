name: Natural Daily Contributions

on:
  schedule:
    - cron: "0 5 * * *" # 1:00 PM PH Time
  workflow_dispatch:

jobs:
  contribute:
    runs-on: ubuntu-latest
    permissions:
      contents: write

    env:
      GIT_AUTHOR_NAME: "JoeyCollado"
      GIT_COMMITTER_NAME: "JoeyCollado"
      GIT_AUTHOR_EMAIL: "144526580+JoeyCollado@users.noreply.github.com"
      GIT_COMMITTER_EMAIL: "144526580+JoeyCollado@users.noreply.github.com"
      TZ: "Asia/Manila"

    steps:
      - uses: actions/checkout@v4

      - name: Run Contribution Script
        env:
          TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          mkdir workspace
          cd workspace

          repos=(
            "JoeyCollado/Java-oop"
            "JoeyCollado/ExpressJsCourse"
            "JoeyCollado/absolute-movie"
            "JoeyCollado/portfolio2"
            "JoeyCollado/prisma-mongodb"
            "JoeyCollado/crud-project"
          )

          msgs=(
            "docs: updated README"
            "chore: metadata refresh"
            "style: formatting pass"
            "refactor: minor cleanup"
            "perf: small optimization"
            "chore: updated config set"
            "docs: maintenance update"
          )

          files=(
            "README.md"
            ".keepalive"
            ".github/commit.log"
          )

          TOTAL=$((RANDOM % 6 + 10)) # 10â€“15 commits
          echo "Total commits today: $TOTAL"

          for i in $(seq 1 $TOTAL); do
            repo=${repos[$RANDOM % ${#repos[@]}]}
            echo "--- Cloning $repo ---"

            git clone "https://x-access-token:${TOKEN}@github.com/$repo.git" >/dev/null 2>&1
            cd "$(basename "$repo")" || { echo "Clone failed"; exit 1; }

            git config user.name "$GIT_AUTHOR_NAME"
            git config user.email "$GIT_AUTHOR_EMAIL"
            git config --global --add safe.directory "$(pwd)"

            target=${files[$RANDOM % ${#files[@]}]}
            mkdir -p "$(dirname "$target")"

            # ensure file exists
            touch "$target"

            echo "- update on $(date '+%Y-%m-%d %H:%M:%S')" >> "$target"

            git add "$target"
            msg=${msgs[$RANDOM % ${#msgs[@]}]}

            git commit -m "$msg" || echo "No commit created"
            git push || echo "Push failed"

            cd ..
            rm -rf "$(basename "$repo")"

            delay=$((RANDOM % 20 + 10))
            echo "Sleeping for $delay seconds"
            sleep $delay
          done
